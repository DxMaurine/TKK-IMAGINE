<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKK-IMAGEN V.3.5</title>
    <script>
        // Periksa apakah accessKey ada di sessionStorage
        const accessKey = sessionStorage.getItem("accessKey");
        
        // Jika TIDAK ada (!accessKey), redirect ke login.html
        if (!accessKey) {
            window.location.href = "login.html";
        }
    </script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<!-- Container untuk notifikasi global -->
<div id="globalNotifContainer"></div>

<div class="header-content">
    <div class="title-container">
        <h1 id="titleEl"><img src="assests/magic-wand.png" alt="TKK Logo" class="header-icon">TKK IMAGEN V3.5</h1>
        <span class="tagline">Where Imagination Becomes Reality</span>
    </div>
</div>

<!-- Theme switch button di bawah header -->
<div class="theme-switch-container">
    <div class="theme-switch" id="themeSwitch">
        <div class="switch-handle"></div>
    </div>
    <span class="theme-label">Switch Theme</span>
</div>
    <main>
      
        <div class="instagram-container">

             <div class="prompt-container">
                <textarea id="promptInput" placeholder="Tulis Prompt Disini..."></textarea>
                <div class="prompt-preview">
                    <p>Final Prompt: <span id="finalPromptDisplay">Prompt Anda akan muncul di sini...</span></p>
                </div>
            </div>
                <div class="tombolcp">
                    <button id="copyPaste" onclick="copyFinalPrompt()" title="Copy prompt" style="border: 1px solid var(--border-color);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    </button>
                    <button id="pastePrompt" onclick="pasteFinalPrompt()" title="Paste Prompt" style="border: 1px solid var(--border-color);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M15 2H9a1 1 0 0 0-1 1v2h8V3a1 1 0 0 0-1-1z"></path></svg>
                    </button>
                    <button id="deletePrompt" onclick="hapusText()" title="Clear prompt" style="color: red; border: 1px solid var(--border-color);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="red" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                    <button id="resetAll" onclick="bukaPopupReset()" title="Reset all settings" style="border: 1px solid var(--border-color);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                    </button>
                    <div class="counter"><span id="genCount">0</span></div>
            <div class="options-container">
                <div class="option-row">
                    <label for="modelSelect">Model AI:</label>
                    <select id="modelSelect">
                        <option value="flux">Flux</option>
                        <option value="flux-anime">Flux Anime</option>
                        <option value="flux-3d">Flux 3D</option>
                        <option value="turbo">Turbo</option>
                        <option value="flux-pro">Flux Pro</option>
                        <option value="flux-realism">Flux Realism</option>
                        <option value="gptimage">GPT Image</option>
                    </select>
                </div>
                
                <div class="option-row">
                    <label for="formatSelect">Format Gambar:</label>
                    <select id="formatSelect">
                        <option value="default">Default (9:16, 1080√ó1920)</option>
                        <option value="square">Persegi (1:1, 1080√ó1080)</option>
                        <option value="landscape">Lanskap (16:9, 1920√ó1080)</option>
                        <option value="landscape_large">Lanskap Besar (16:9, 2560√ó1440)</option>
                        <option value="portrait_large">Potret WHD (9:16, 1440√ó2560)</option>
                    </select>
                </div>
                
                <div class="option-row">
                    <label for="enhanceCheck">Tingkatkan Kualitas:</label>
                    <input type="checkbox" id="enhanceCheck">
                    <span class="tooltip">Optimasi prompt dengan model AI</span>
                </div>
            </div>
            
<div class="advanced-settings">
    <h2 class="settings-title">‚öôÔ∏è Advanced Settings</h2>
    
    <div class="accordion">
        <!-- Cyberpunk Section -->
        <div class="accordion-item">
            <div class="accordion-header">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    <span class="accordion-icon">üåÜ</span>
                    Cyberpunk Creation
                    <span class="accordion-arrow">‚ñº</span>
                </button>
            </div>
            <div class="accordion-content">
                <div class="select-container">
                    <select id="cyberpunkStyleSelect" class="style-select" onchange="selectCyberpunkStyle(this)">
                        <option value="">-- Pilih Gaya Cyberpunk --</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Art Style Section -->
        <div class="accordion-item">
            <div class="accordion-header">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    <span class="accordion-icon">üé®</span>
                    Style Art
                    <span class="accordion-arrow">‚ñº</span>
                </button>
            </div>
            <div class="accordion-content">
                <div class="select-container">
                    <select id="artStyleSelect" class="style-select" onchange="selectArtStyle(this)">
                        <option value="">-- Pilih Gaya Seni --</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Camera Effects Section -->
        <div class="accordion-item">
            <div class="accordion-header">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    <span class="accordion-icon">üì∑</span>
                    Camera Effects
                    <span class="accordion-arrow">‚ñº</span>
                </button>
            </div>
            <div class="accordion-content">
                <div class="select-container">
                    <select id="cameraEffectSelect" class="style-select" onchange="selectCameraEffect(this)">
                        <option value="">-- Pilih Efek Kamera --</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="controls">
<button id="generateBtn" onclick="generateAiImage()">Generate Gambar</button>
                    
</div>

<style>
.advanced-settings {
    margin: 15px;
    padding: 20px;
    background: var(--gradient-light);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-convex);
}

.settings-title {
    color: var(--text-color-dark);
    font-size: 1.5rem;
    margin-bottom: 20px;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.accordion {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.accordion-item {
    background: var(--bg-tertiary);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-convex);
    overflow: hidden;
    transition: all 0.3s ease;
}

.accordion-header {
    width: 100%;
}

.accordion-button {
    width: 100%;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--gradient-light);
    border: none;
    cursor: pointer;
    font-size: 1.1rem;
    color: var(--text-color);
    font-weight: 600;
    text-align: left;
    transition: all 0.3s ease;
}

.accordion-button:hover {
    background: var(--gradient-dark);
}

.accordion-icon {
    font-size: 1.2rem;
}

.accordion-arrow {
    margin-left: auto;
    transition: transform 0.3s ease;
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    padding: 0 20px;
    background: var(--bg-tertiary);
}

.accordion-item.active .accordion-content {
    max-height: 300px;
    padding: 20px;
}

.accordion-item.active .accordion-arrow {
    transform: rotate(180deg);
}

.style-tip {
    margin-top: 15px;
    padding: 10px;
    background: var(--gradient-light);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-concave);
}
</style>

<script>
function toggleAccordion(button) {
    const item = button.closest('.accordion-item');
    const isActive = item.classList.contains('active');
    
    // Close all accordion items
    document.querySelectorAll('.accordion-item').forEach(accItem => {
        accItem.classList.remove('active');
    });
    
    // Open clicked item if it wasn't active
    if (!isActive) {
        item.classList.add('active');
    }
}
</script>
            
                <!-- Popup -->
                <div id="popupReset" class="popup-overlay">
                <div class="popup-box">
                    <p>Yakin ingin mereset semua pengaturan?</p>
                    <div class="popup-buttons">
                    <button onclick="konfirmasiReset(true)">‚úÖ Yes</button>
                    <button onclick="konfirmasiReset(false)">‚ùå No</button>
                    </div>
                  </div>
                </div>
            <!-- ini adalah setting gambar container--> 
            <div class="result-container">
                <div class="image-grid" id="imageGrid">
                    <!-- Image Container 0 (satu-satunya yang ditampilkan saat awal) -->
                    <div class="image-container" id="resultImageContainer0">
                        <p class="initialMessage">Gambar yang dihasilkan AI akan muncul di sini</p>
                        <img class="resultImage" hidden onclick="previewImage(this)">
                        <span class="close" onclick="closeModal()" hidden>√ó</span>
                        <div class="statusMessage" hidden></div>
                        <button class="regenerate-style-btn" onclick="regenerateWithStyle(0)" hidden>Generate ulang</button>
                        <button class="download-image-btn" onclick="downloadImage(0)" hidden>Unduh Gambar</button>
                    </div>
                </div>
                
                <!-- Tombol untuk menambah container baru -->
                <div class="add-container-action">
                    <button id="addContainerBtn" onclick="addImageContainer()">+ Tambah Container</button>
                    <button id="resetContainerBtn" onclick="resetLastContainer()">‚Ü∫ Reset</button>
                </div>
            </div>
                 <!-- Image History Container -->
                <div class="history-container">
                    <div class="history-title">
                        <h3>Riwayat Gambar</h3>
                        <p>Your History generated images will appear here</p>
                    </div>
                    <div class="history-grid" id="historyGrid">
                        <!-- History items will be added here dynamically -->
                    </div>
                    <div class="history-actions">
                        <button id="clearHistoryBtn" onclick="clearHistory()">Hapus Riwayat</button>
                        <button id="downloadHistoryBtn" onclick="downloadHistory()">Unduh Riwayat</button>
                    </div>
                </div>
                
                <!--ini adalah tombol downloadAll-->
                <div class="image-actions" hidden>
                    <div class="action-icons">
                        <span class="action-icon" id="downloadAllBtn" onclick="downloadAllImages()">&#10515; unduh semua gambar</span>
                </div>
                </div>
                
               
</main>

          
</main>
</body>
 <footer class="custom-footer">
        <div class="footer-thanks">
          Thanks To: <strong>REMBOL TEAM'S</strong> dan <strong>TKK FB GROUP</strong>
        </div>
        <div class="footer-caption">Best Free AI image generator</div>
        <div class="footer-copyright">
          ¬© 2025 | Support By ‚ô•Ô∏è <strong>REMBOL TEAM'S</strong>
        </div>
      </footer>
</html>
    
    <style>
    /* Import font - removed and replaced with sans-serif bold */
    /* @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap'); */
    
    /* Gaya untuk header yang lebih stylist */
    .header-content {
        background: var(--gradient-light);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow-convex);
        margin-bottom: 25px;
        position: relative;
        overflow: hidden;
    }

    .header-content::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: rotate(45deg);
        animation: shine 3s infinite;
        pointer-events: none;
    }

    .title-container {
        position: relative;
        z-index: 5;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    h1 {
        color: var(--text-color-dark);
        font-size: 2.2rem;
        font-weight: 600;
        margin: 0;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1), -2px -2px 4px rgba(255,255,255,0.3);
    }

    .header-icon {
        height: 40px;
        width: auto;
        margin-right: 15px;
        filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    .tagline {
        font-size: 1rem;
        color: var(--text-color);
        font-style: italic;
        opacity: 0.8;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        background-size: 200% 1px;
        background-position: 0% 100%;
        background-repeat: no-repeat;
        padding-bottom: 5px;
        animation: slide-bg 3s linear infinite;
    }

    @keyframes slide-bg {
        0% { background-position: 0% 100%; }
        100% { background-position: 200% 100%; }
    }
    
    /* Gaya untuk sistem notifikasi global */
    #globalNotifContainer {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        max-width: 400px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: none;
    }

    .global-notif {
        background: var(--gradient-light);
        color: var(--text-color);
        padding: 15px 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow-convex);
        font-family: sans-serif;
        font-weight: bold;
        font-size: 14px;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
        pointer-events: auto;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .global-notif.show {
        opacity: 1;
        transform: translateY(0);
    }

    .global-notif.success {
        border-left: 4px solid #4CAF50;
    }

    .global-notif.error {
        border-left: 4px solid #F44336;
    }

    .global-notif.info {
        border-left: 4px solid #2196F3;
    }

    .global-notif.warning {
        border-left: 4px solid #FF9800;
    }

    .global-notif-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: var(--accent-color);
        width: 100%;
        transform-origin: left;
        animation: progress-animation 3s linear forwards;
    }

    .global-notif-close {
        background: none;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        margin-left: 10px;
        font-size: 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .global-notif-close:hover {
        opacity: 1;
    }

    @keyframes progress-animation {
        from { transform: scaleX(1); }
        to { transform: scaleX(0); }
    }
    

    :root {
      /* Light theme (default) - Modern Soft UI design */
      --bg-color: #e0e0e0; /* Dull white */
      --bg-secondary: #d4d4d4; /* Dull secondary */
      --bg-tertiary: #ebebeb; /* Dull tertiary */
      --text-color: #334155;
      --text-color-dark: #7c3aed; /* Modern purple */
      --text-color-light: #64748b;
      --box-shadow-convex: 8px 8px 16px #c8c8c8, -8px -8px 16px #ebebeb;
      --box-shadow-concave: inset 8px 8px 16px #c8c8c8, inset -8px -8px 16px #ebebeb;
      --box-shadow-pressed: inset 4px 4px 8px #c8c8c8, inset -4px -4px 8px #ebebeb;
      --border-color: rgba(235, 235, 235, 0.5);
      --highlight-color: rgba(235, 235, 235, 0.9);
      --border-radius: 16px;
      --gradient-light: linear-gradient(135deg, #ebebeb, #d4d4d4);
      --gradient-dark: linear-gradient(135deg, #d4d4d4, #ebebeb);
      --transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
      --accent-color: #7c3aed; /* Modern purple accent */
      --accent-secondary: #06b6d4; /* Teal accent for contrast */
    }
    
    [data-theme="dark"] {
      --bg-color: #202020;
      --bg-secondary: #1f1f1f;
      --bg-tertiary: #2d2d2d;
      --text-color: #ffffff;
      --text-color-dark: #009be2; /* Windows 11 accent blue */
      --text-color-light: #cccccc;
      --box-shadow-convex: 8px 8px 16px #171717, -8px -8px 16px #2a2a2a;
      --box-shadow-concave: inset 8px 8px 16px #171717, inset -8px -8px 16px #2a2a2a;
      --box-shadow-pressed: inset 4px 4px 8px #171717, inset -4px -4px 8px #2a2a2a;
      --border-color: rgba(255, 255, 255, 0.1);
      --highlight-color: rgba(255, 255, 255, 0.05);
      --border-radius: 16px;
      --gradient-light: linear-gradient(135deg, #2d2d2d, #202020);
      --gradient-dark: linear-gradient(135deg, #202020, #2d2d2d);
      --transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
      --accent-color: #0fa1e6; /* Windows 11 accent blue */
      --accent-secondary: #51aeff; /* Lighter blue for contrast */
    }
    
    body {
      font-family: sans-serif;
      font-weight: bold;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      text-align: left;
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      min-height: 100vh;
      position: relative;
      /* Hapus padding-bottom: 80px; */
    }
    
    /* Header with title - enhanced 3D */
    header {
      background: var(--gradient-light);
      padding: 25px 0;
      text-align: center;
      margin-bottom: 30px;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: var(--box-shadow-convex);
    }
    
    .title-container {
      position: relative;
      z-index: 5;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    #logoImg {
      height: 60px;
      width: auto;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow-convex);
      transition: transform 0.3s ease;
    }
    
    #logoImg:hover {
      transform: scale(1.05);
    }
    
    .small-logo {
      height: 30px;
      width: auto;
      border-radius: 8px;
      margin-right: 10px;
      vertical-align: middle;
      box-shadow: var(--box-shadow-convex);
    }
    
    #titleEl {
      color: var(--text-color-dark);
      font-size: 2.5rem;
      font-weight: 600;
      margin: 0;
      letter-spacing: 1px;
      position: relative;
      /* Enhanced 3D text effect */
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1), -2px -2px 4px rgba(255,255,255,0.3);
    }
    
    /* Theme switch - redesigned */
    .theme-switch-container {
      position: relative; /* Changed from fixed to relative */
      bottom: auto; /* Removed bottom positioning */
      left: auto; /* Removed left positioning */
      transform: none; /* Removed transform */
      display: flex;
      flex-direction: row; /* Changed from column to row */
      align-items: center;
      justify-content: center;
      gap: 15px;
      z-index: 100;
      background: var(--gradient-light);
      padding: 12px 25px;
      border-radius: 30px;
      box-shadow: var(--box-shadow-convex);
      margin: 20px auto 20px; /* Negative margin to overlap with header */
      width: max-content;
      transition: all 0.3s ease;
    }
    
    .theme-switch-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .theme-switch {
      width: 50px;
      height: 24px;
      background-color: var(--bg-tertiary);
      border-radius: 30px;
      position: relative;
      cursor: pointer;
      box-shadow: var(--box-shadow-concave);
      transition: all 0.3s ease;
    }
    
    .switch-handle {
      width: 20px;
      height: 20px;
      background: var(--gradient-light);
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      box-shadow: var(--box-shadow-convex);
      transition: all 0.3s ease;
    }
    
    [data-theme="dark"] .switch-handle {
      left: 28px;
    }
    
    .theme-label {
      font-size: 14px;
      color: var(--text-color);
      font-weight: 600;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }
    
    /* Added sun and moon icons */
    .theme-switch::before {
      content: "‚òÄÔ∏è";
      position: absolute;
      left: 6px;
      top: 1px;
      font-size: 10px;
      opacity: 0.7;
    }
    
    .theme-switch::after {
      content: "üåô";
      position: absolute;
      right: 6px;
      top: 1px;
      font-size: 10px;
      opacity: 0.7;
    }
    
    /* Main content container */
    main {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
    }
    
    .instagram-container {
      background: var(--gradient-light);
      border-radius: var(--border-radius);
      overflow: hidden;
      position: relative;
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
    }
    
    /* App header */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: var(--gradient-dark);
      position: relative;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .logo {
      font-weight: 600;
      color: var(--text-color-dark);
      font-size: 18px;
      /* Enhanced 3D text effect */
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1), -2px -2px 4px rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
    }
    
    .header-icons {
      display: flex;
      gap: 15px;
    }
    
    .icon {
      font-size: 16px;
      cursor: pointer;
      position: relative;
      z-index: 1;
      padding: 10px;
      border-radius: 50%;
      background: var(--gradient-light);
      box-shadow: var(--box-shadow-convex);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
    }
    
    .icon:hover {
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(2px);
    }
    
    /* Prompt input container */
    .prompt-container {
      padding: 20px;
      background: var(--gradient-light);
      position: relative;
      /* Enhanced 3D effect */
      box-shadow: var(--box-shadow-concave);
      margin: 15px;
      border-radius: var(--border-radius);
    }
    
    #promptInput {
      width: 94%;
      height: 160px;
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      font-size: 16px;
      resize: none;
      border: none;
      font-family: sans-serif;
      font-weight: bold;
      background: var(--bg-tertiary);
      color: var(--text-color);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      transition: all 0.3s;
    }
    
    #promptInput:focus {
      outline: none;
      box-shadow: var(--box-shadow-pressed);
    }
    
    .prompt-preview {
      margin-bottom: 15px;
      padding: 15px;
      border-radius: var(--border-radius);
      font-size: 14px;
      background: var(--bg-tertiary);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
    }
    
    .prompt-preview p {
      margin: 0;
      color: var(--text-color-light);
    }
    
    #finalPromptDisplay {
      font-weight: 500;
      color: var(--text-color);
    }
    
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #generateBtn {
      font-family: sans-serif;
      font-weight: bold;
      /* Enhanced 3D gradient background */
      background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-secondary) 100%);
      color: #ffffff;
      border: none;
      border-radius: var(--border-radius);
      padding: 15px 25px;
      cursor: pointer;
      box-shadow: 
        var(--box-shadow-convex),
        0 5px 15px rgba(0,0,0,0.2);
      position: relative;
      font-size: 25px;
      width: 90%;
      height: 60px;
      max-width: 600px;
      margin: 0 auto;
      display: block;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #generateBtn:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, var(--accent-secondary) 0%, var(--accent-color) 100%);
      box-shadow:
        var(--box-shadow-convex),
        0 8px 20px rgba(0,0,0,0.3);
    }
    
    #generateBtn:active {
      transform: translateY(1px);
      box-shadow: var(--box-shadow-pressed);
      background: linear-gradient(135deg, var(--accent-color) 30%, var(--accent-secondary) 70%);
    }
    
    #generateBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      background: linear-gradient(135deg, #808080 0%, #a0a0a0 100%);
      box-shadow: var(--box-shadow-pressed);
    }
      
    /*ResetAll*/

    #resetAll {
      font-family: sans-serif;
      font-weight: bold;
      background: var(--gradient-light);
      color: var(--text-color-dark);
      border: none;
      border-radius: var(--border-radius);
      padding: 12px 16px; /* Perbaikan dari '12px px' */
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--box-shadow-convex);
      position: relative;
      font-size: 15px;
      margin-top: 10px;
      margin-bottom: 10px;

    /* Tambahan: beri jarak dari tombol sebelumnya */
      margin-left: 12px;
    }

    
    #resetAll:hover {
      transform: translateY(2px);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
    }
    
    #resetAll:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(4px);
    }
    
    #resetAll:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    

    /*tombol hapus*/
      
     #deletePrompt {
        font-family: sans-serif;
        font-weight: bold;
        background: var(--gradient-light);
        color: var(--text-color-dark);
        border: none;
        border-radius: var(--border-radius);
        padding: 12px; /* ‚Üê kamu juga punya '12px px' yang error */
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--box-shadow-convex);
        position: relative;
        font-size: 15px;

        /* Tambahan: beri jarak dari kiri */
        margin-left: 16px; /* atau 1rem, 20px, dll */
        }

    
    #deletePrompt:hover {
      transform: translateY(2px);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
    }
    
    #deletePrompt:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(4px);
    }
    
    #deletePrompt:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
      
    /*Tombol Copy*/
      
    #copyPaste {
        font-family: sans-serif;
        font-weight: bold;
        background: var(--gradient-light);
        color: var(--text-color-dark);
        border: none;
        border-radius: var(--border-radius);
        padding: 12px 16px; /* Perbaikan dari '12px px' */
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--box-shadow-convex);
        position: relative;
        font-size: 15px;

        /* Tambahan: beri jarak dari tombol sebelumnya */
        margin-left: 12px;
        }

    
    #copyPaste:hover {
      transform: translateY(2px);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
    }
    
    #copyPaste:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(4px);
    }
    
    #copyPaste:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /*Tombol paste*/
      
      #pastePrompt {
        font-family: sans-serif;
        font-weight: bold;
        background: var(--gradient-light);
        color: var(--text-color-dark);
        border: none;
        border-radius: var(--border-radius);
        padding: 12px 16px; /* Perbaikan dari '12px px' */
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--box-shadow-convex);
        position: relative;
        font-size: 15px;

        /* Tambahan: beri jarak dari tombol sebelumnya */
        margin-left: 12px;
        }

    
    #pastePrompt:hover {
      transform: translateY(2px);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
    }
    
    #pastePrompt:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(4px);
    }
    
    #pastePrompt:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Image History Container Styles */
    .history-container {
        background: var(--gradient-light);
        padding: 15px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow-concave);
        margin: 15px;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        transform: translateZ(0);
    }
    
    .history-container:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-pressed);
    }
    
    .history-title {
        text-align: center;
        margin-bottom: 12px;
    }
    
    .history-title h3 {
        color: var(--text-color-dark);
        margin-bottom: 4px;
        position: relative;
        display: inline-block;
        font-size: 1.1em;
    }
    
    .history-title h3::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary));
        border-radius: 2px;
    }
    
    .history-title p {
        color: var(--text-color-light);
        font-size: 0.8em;
        margin-top: 4px;
    }
    
    .history-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
        max-height: 250px;
        overflow-y: auto;
        padding: 8px;
    }
    
    .history-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 2px 2px 4px rgba(0,0,0,0.1),
                    -2px -2px 4px rgba(255,255,255,0.5);
        transition: transform 0.3s ease;
        aspect-ratio: 1/1;
        transform: translateZ(0);
    }
    
    .history-item:hover {
        transform: scale(1.03) translateZ(5px);
    }
    
    .history-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
    }
    
    .history-item .delete-btn {
        position: absolute;
        top: 4px;
        right: 4px;
        background: rgba(255, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 10px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .history-item:hover .delete-btn {
        opacity: 1;
    }
    
    .history-actions {
        display: flex;
        justify-content: center;
        gap: 12px;
    }
    
    .history-actions button {
        background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        font-size: 0.9em;
        transition: all 0.3s ease;
        box-shadow: 2px 2px 4px rgba(0,0,0,0.1),
                    -2px -2px 4px rgba(255,255,255,0.5);
        transform: translateZ(0);
    }
    
    .history-actions button:hover {
        transform: translateY(-2px) translateZ(5px);
        box-shadow: 3px 3px 6px rgba(0,0,0,0.15),
                    -3px -3px 6px rgba(255,255,255,0.6);
    }
      
      .counter {
      font-size: 16px;
      font-weight: bold;
      color: #ffffff;
      padding: 10px 15px;
      border-radius: var(--border-radius);
      /* Gradient background untuk eye-catching */
      background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
      /* Enhanced 3D effect */
      box-shadow: 0 4px 15px rgba(0,0,0,0.2), inset 0 -2px 5px rgba(0,0,0,0.1);
      /* Posisi di sebelah tombol reset */
      position: relative; /* Ubah dari absolute ke relative */
      display: inline-block;
      margin-left: 12px; /* Jarak dari tombol reset */
      /* Animasi subtle pulse */
      animation: pulse 2s infinite;
      /* Tambahan styling */
      min-width: 30px;
      text-align: center;
      vertical-align: middle; /* Sejajarkan dengan tombol */
    }
    
    /* Animasi pulse untuk counter */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Styling untuk angka di dalam counter */
    #genCount {
      display: inline-block;
      font-weight: bold;
    }
    
    
    
    /* Options container */
    .options-container {
      padding: 20px;
      background: var(--gradient-light);
      position: relative;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      margin: 15px;
      border-radius: var(--border-radius);
    }
    
    .option-row {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      position: relative;
    }
    
    .option-row label {
      width: 120px;
      font-size: 14px;
      color: var(--text-color);
      font-weight: 500;
    }
    
    .option-row select, .option-row input[type="checkbox"] {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 14px;
      background: var(--bg-tertiary);
      color: var(--text-color);
      font-family: sans-serif;
      font-weight: bold;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      transition: all 0.3s;
    }
    
    .option-row select:focus {
      outline: none;
      box-shadow: var(--box-shadow-pressed);
    }
    
    .option-row input[type="checkbox"] {
      flex: 0;
      width: 24px;
      height: 24px;
      margin-right: 10px;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      border-radius: 6px;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
    }
    
    .option-row input[type="checkbox"]:checked {
      background-color: var(--accent-color);
      /* Enhanced 3D convex effect when checked */
      box-shadow: var(--box-shadow-convex);
      position: relative;
      transition: all 0.3s ease;
    }

    .option-row input[type="checkbox"]:checked::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      animation: checkmark 0.3s ease-in-out;
    }

    @keyframes checkmark {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0);
      }
      50% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    .tooltip {
      margin-left: 10px;
      font-size: 13px;
      color: var(--text-color-light);
    }
    
    /* Art styles sections */
    .style-sections {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: var(--gradient-light);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      margin: 15px;
      border-radius: var(--border-radius);
    }
    
    .section h3 {
      margin: 0 0 15px 0;
      color: var(--text-color-dark);
      font-size: 18px;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      /* Enhanced 3D text effect */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1), -1px -1px 2px rgba(255,255,255,0.2);
      border-bottom: 1px solid var(--border-color);
    }
    
    .highlighted-section {
      position: relative;
      padding: 15px;
      background: var(--gradient-light);
      border-radius: var(--border-radius);
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
    }
    
    .highlighted-section:hover {
      transform: translateY(-2px);
      box-shadow: 6px 6px 12px rgba(0,0,0,0.15), -6px -6px 12px rgba(255,255,255,0.25);
    }
    
    .style-tip {
      border-radius: var(--border-radius);
      padding: 12px;
      margin-top: 10px;
      background: var(--bg-tertiary);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
    }
    
    .style-tip p {
      margin: 0;
      color: var(--text-color-light);
      font-weight: 400;
      font-size: 13px;
    }
    
    .feature-hint {
      font-size: 13px;
      color: var(--text-color-light);
      font-weight: normal;
    }
    
    /* Select styles */
    
    
      
    .select-container {
      width: 100%;
      position: relative;
      margin-bottom: 10px;
    }
    
    .style-select {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 14px;
      background: var(--bg-tertiary);
      color: var(--text-color);
      font-family: sans-serif;
      font-weight: bold;
      appearance: none;
      cursor: pointer;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      transition: all 0.3s;
    }
    
    .style-select:focus {
      outline: none;
      box-shadow: var(--box-shadow-pressed);
    }
    
    .select-container::after {
      content: '‚ñº';
      font-size: 12px;
      color: var(--text-color-light);
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }
    
    .style-select option {
      background-color: var(--bg-secondary);
      color: var(--text-color);
      padding: 10px;
    }
    
    /* Result container */
    .result-container {
      margin-top: 10px;
    }
    
    /* Image grid layout */
    .image-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      padding: 20px;
      background: var(--gradient-light);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      margin: 15px;
      border-radius: var(--border-radius);
      justify-content: center;
    }
    
    .image-container {
      min-width: 180px;
      max-width: 100%;
      width: auto;
      min-height: 180px;
      height: auto;
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-radius: var(--border-radius);
      overflow: hidden;
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      transition: all 0.3s;
      padding: 10px;
      flex-basis: calc(50% - 15px);
      flex-grow: 1;
    }
    
    .image-container:hover {
      transform: translateY(-2px);
      box-shadow: var(--box-shadow-pressed);
    }
    
    .initialMessage, .statusMessage {
      color: var(--text-color-light);
      font-size: 13px;
      text-align: center;
      padding: 10px;
      max-width: 100%;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
    }
    
    .statusMessage {
      position: absolute;
      top: 10px; /* Changed from bottom to top */
      background: var(--gradient-light);
      padding: 8px 12px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 12px;
      max-width: 90%;
      margin: 0 auto;
      left: 50%;
      transform: translateX(-50%);
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
      z-index: 10; /* Added to ensure message appears above other elements */
    }
    .resultImage {
      width: 100%;
      height: auto;
      object-fit: contain;
      border-radius: var(--border-radius);
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
      transition: all 0.3s;
    }
    
    .resultImage:hover {
      transform: scale(1.02);
      box-shadow: 6px 6px 12px rgba(0,0,0,0.15), -6px -6px 12px rgba(255,255,255,0.25);
    }
    
    /* Regenerate button */
    .regenerate-style-btn {
      position: absolute;
      bottom: 20px;
      background: var(--gradient-light);
      border: none;
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text-color);
      font-family: sans-serif;
      font-weight: bold;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
      z-index: 10;
      max-width: 90%;
      width: auto; /* Changed from fixed width to auto */
      white-space: normal; /* Allow text to wrap */
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
    }
    
    .regenerate-style-btn:hover {
      transform: translateY(-2px);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.15), -4px -4px 8px rgba(255,255,255,0.25);
    }
    
    .regenerate-style-btn:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(0);
    }
    
    /* Download image button */
        .download-image-btn {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-light);
            border: none;
            border-radius: 10px;
            padding: 10px 12px;
            color: var(--text-color);
            font-family: sans-serif;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--box-shadow-convex);
            z-index: 10;
            max-width: 90%;
            width: auto;
            white-space: normal;
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
        }

        .download-image-btn:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.15), -4px -4px 8px rgba(255, 255, 255, 0.25);
        }

        .download-image-btn:active {
        box-shadow: var(--box-shadow-pressed);
        transform: translateX(-50%) translateY(0);
        }

    
    .image-actions {
      padding: 20px;
      background: var(--gradient-light);
      /* Enhanced 3D concave effect */
      box-shadow: var(--box-shadow-concave);
      margin: 15px;
      border-radius: var(--border-radius);
    }
    
    .action-icons {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .action-icon {
      font-size: 15px;
      cursor: pointer;
      padding: 20px;
      border-radius: 10%;
      background: var(--gradient-light);
      /* Enhanced 3D convex effect */
      box-shadow: var(--box-shadow-convex);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 600px;
      height: 40px;
    }
    
    .action-icon:hover {
      transform: translateY(-2px);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.15), -4px -4px 8px rgba(255,255,255,0.25);
    }
    
    .action-icon:active {
      /* Enhanced 3D pressed effect */
      box-shadow: var(--box-shadow-pressed);
      transform: translateY(0);
    }
    
    .likes, .caption {
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--text-color-light);
    }
    
    .likes strong, .caption strong {
      color: var(--text-color);
      font-weight: 600;
    }
    
    /* Loading indicator */
    .loading-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      /* Enhanced 3D concave spinning effect */
      background: var(--gradient-light);
      box-shadow: var(--box-shadow-concave);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .loading-indicator::after {
      content: '';
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--text-color);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Highlight for camera effects */
    .camera-effect-highlight {
      background-color: var(--highlight-color);
      padding: 2px 5px;
      border-radius: 8px;
      font-weight: 500;
      display: inline-block;
      /* Enhanced 3D convex effect */
      box-shadow: 2px 2px 4px rgba(0,0,0,0.05), -2px -2px 4px rgba(255,255,255,0.3);
    }
    
    /* Media queries for responsiveness */
    @media (max-width: 600px) {
      #titleEl {
        font-size: 2rem;
      }
      
      #logoImg {
        height: 50px;
      }
      
      .option-row {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .option-row label {
        width: 100%;
        margin-bottom: 8px;
      }
      
      .option-row select, .option-row input {
        width: 100%;
      }
      
      .tooltip {
        margin-left: 0;
        margin-top: 5px;
      }
      
      .image-grid {
        flex-direction: column;
      }
      
      .image-container {
        flex-basis: 100%;
      }
      
      .theme-switch-container {
        padding: 10px 15px;
      }
      
      .small-logo {
        height: 24px;
      }
    }

     /* Media queries for reset */
       .popup-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        }

       .popup-box {
        background: var(--bg-secondary);
        padding: 20px 30px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .popup-buttons {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        justify-content: center;
        }

        .popup-buttons button {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        }

      /* popupUpscale*/

      .popup-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .popup-box {
        background: var(--bg-secondary);
        padding: 30px;
        border-radius: 16px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        width: 90%;
        max-width: 300px;
      }

      .popup-box button {
        display: block;
        margin: 10px auto;
        padding: 12px 20px;
        font-weight: bold;
        background: var(--gradient-light);
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: var(--box-shadow-convex);
        transition: all 0.3s ease;
      }

      .popup-box button:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-pressed);
      }
      
      /* Tombol Add Container */
      .add-container-action {
        display: flex;
        justify-content: center;
        margin: 15px 0;
      }

      #addContainerBtn {
        font-family: sans-serif;
        font-weight: bold;
        background: var(--gradient-light);
        color: var(--text-color-dark);
        border: none;
        border-radius: var(--border-radius);
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--box-shadow-convex);
        position: relative;
        font-size: 15px;
      }

      #addContainerBtn:hover {
        transform: translateY(2px);
        box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
      }

      #addContainerBtn:active {
        box-shadow: var(--box-shadow-pressed);
        transform: translateY(4px);
      }

      #resetContainerBtn {
        font-family: sans-serif;
        font-weight: bold;
        background: var(--gradient-dark);
        color: var(--text-color-dark);
        border: none;
        border-radius: var(--border-radius);
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--box-shadow-convex);
        position: relative;
        font-size: 15px;
        margin-left: 10px;
      }

      #resetContainerBtn:hover {
        transform: translateY(2px);
        box-shadow: 3px 3px 6px rgba(0,0,0,0.15), -3px -3px 6px rgba(255,255,255,0.25);
      }

      #resetContainerBtn:active {
        box-shadow: var(--box-shadow-pressed);
        transform: translateY(4px);
      }

      #resetContainerBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: var(--box-shadow-concave);
      }

      


      




</style>
    
      
    <!-- Modal Preview -->
    <div id="imagePreviewModal" class="modal" style="display:none;">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="modalPreviewImage">
    </div>
    
    <style>
    /* Modal Preview */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      padding-top: 60px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
    }
  
    .modal-content {
      margin: auto;
      display: block;
      max-width: 90%;
      max-height: 80vh;
    }
  
    .close {
      position: absolute;
      top: 20px;
      right: 35px;
      color: white;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }
    
    /* History Modal Styles */
    .history-modal {
      display: none;
      position: fixed;
      z-index: 1100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      align-items: center;
      justify-content: center;
    }
    
    .history-modal-content {
      position: relative;
      background: var(--bg-tertiary);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow-convex);
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
    }
    
    .history-modal-content img {
      width: 100%;
      height: auto;
      max-height: 80vh;
      object-fit: contain;
      border-radius: var(--border-radius);
    }
    
    .no-history {
      text-align: center;
      color: var(--text-color-light);
      padding: 20px;
      font-style: italic;
    }
  </style>
    
    <script>

    // Initialize state variables
    let generationCount = 0;
    let selectedStyle = null;
    let selectedFilter = null;
    let selectedCyberpunkStyle = null; // New variable for cyberpunk style
    let isGenerating = false;
    let currentImageUrls = []; // Store all current image URLs for download
    let originalPrompt = ""; // Store the original prompt for regeneration
    
    // Art style list (60 items)
    const artStyles = [
      "Photorealistic", "Abstract", "Impressionist", "Surrealism", "Minimalist",
      "Pop Art", "Cubism", "Pixel Art", "Anime", "Comic Book",
      "Watercolor", "Oil Painting", "Charcoal", "Pencil Sketch", "Digital Art",
      "Vaporwave", "Steampunk", "Cyberpunk", "Art Nouveau", "Art Deco",
      "Gothic", "Renaissance", "Baroque", "Expressionism", "Futurism",
      "Folk Art", "Cartoon", "3D Rendering", "Pointillism", "Graffiti",
      "Ukiyo-e", "Fauvist", "Dadaism", "Hyperrealism", "Low Poly",
      "Bauhaus", "Rococo", "Neoclassicism", "Mannerism", "Romanticism",
      "Naive Art", "Constructivism", "De Stijl", "Art Brut", "Suprematism",
      "Primitivism", "Tonalism", "Tachisme", "Precisionism", "Color Field",
      "Neo-Expressionism", "Brutalism", "Memphis Design", "Hard Edge", "CoBrA",
      "Shin-hanga", "Neo-Byzantine", "Symbolism", "Classicism", "Naturalism"
    ];
    
    // Camera filter effects (60 items total)
      const cameraFilters = [
        "Vintage", "Noir", "Sepia", "Vivid", "HDR",
        "Blur", "Vignette", "High Contrast", "Low Contrast", "Saturation",
        "Desaturation", "Retro", "Film Grain", "Dreamy", "Infrared",
        "Polaroid", "Dramatic", "Soft Focus", "Tilt-Shift", "Bokeh",
        "Cinematic", "Cross Process", "Negative", "Solarize", "Fisheye",
        "Glitch", "Mosaic", "Double Exposure", "Holga", "Lomo",

        // Tambahan baru
        "Black and White", "Lens Flare", "Color Splash", "Pastel", "Split Tone",
        "Duotone", "Technicolor", "Night Vision", "Thermal Vision", "VHS",
        "Sketch", "Cartoon", "Emboss", "Oil Paint", "Halftone",
        "Motion Blur", "Radial Blur", "Zoom Blur", "Grunge", "Matrix Effect",
        "Cyber Glow", "Neon Pulse", "Digital Noise", "CRT", "Pixel Stretch",
        "Glowing Edges", "Chromatic Aberration", "InfraGlow", "Depth Map", "Anime Glow"
      ];

    
    // Cyberpunk creator styles (50 items)
    
    const cyberpunkCreatorStyles = [
      "Akira Inspired", "Blade Runner Style", "Ghost in the Shell", "Neuromancer Vibes", "Cybernetic Enhanced",
      "Neon Dystopia", "Neo-Tokyo", "Digital Wasteland", "Technoir", "Cyborg Fusion",
      "Neoteric Punk", "Cyber Brutalism", "Synthetic Future", "Holographic Interface", "Megacorp Aesthetic",
      "Cybernetic Implants", "Vaporwave Cyberpunk", "Retrofuturistic Tech", "Glitch Matrix", "Cyberwire",
      "Transhumanist", "Electropunk", "Digital Decay", "Cyber Noir", "Electric Dreams",
      "Chrome and Neon", "Biotech Evolution", "Cyberspace Realm", "Neural Networks", "Digital Urban",
      "Dystopian Metropolis", "Megacity Sprawl", "Tech Noir Film", "Neon Rain", "Android Future",
      "VR Cyberpunk", "Hacktivist Aesthetic", "Cyber Outrun", "Technophile", "Wetware Style",
      "Dark Synthwave", "Hypertech", "Data Confluence", "Cybercrime Scene", "Neurolink Aesthetic",
      "Cyber Rebellion", "AI Sentience", "Post-Cyberpunk", "High-Tech Low-Life", "Synthetic Replicant"
    ];
    
    //bukatombol reset

        function bukaPopupReset() {
        document.getElementById("popupReset").style.display = "flex";
        }

        function konfirmasiReset(setuju) {
        document.getElementById("popupReset").style.display = "none";
        if (setuju) {
            resetSemuaInput(); // panggil fungsi reset
        }
        }



    // resetAll

        function resetSemuaInput() {
        // Reset semua <textarea> dan <input type="text">
        document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
            el.value = '';
        });

        // Reset semua <div contenteditable>
        document.querySelectorAll('[contenteditable="true"]').forEach(el => {
            el.innerText = '';
        });

        // Reset semua <select> (dropdown)
        document.querySelectorAll('select').forEach(el => {
            el.selectedIndex = 0;
        });

        // Reset semua checkbox & radio button
        document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(el => {
            el.checked = false;
        });

        // Hapus semua isi dari .image-grid (kosongkan gambar)
        document.querySelectorAll('.image-container').forEach(container => {
        const message = container.querySelector('.initialMessage');
        if (message) message.hidden = false;

        const img = container.querySelector('img.resultImage');
         if (img) {
        img.src = "";
        img.hidden = true;
        }

        container.querySelectorAll('.close, .statusMessage, .regenerate-style-btn, .download-image-btn').forEach(el => {
        el.hidden = true;
      });
    });



        // Reset final prompt preview kalau ada
        const preview = document.getElementById("finalPromptDisplay");
        if (preview) {
            preview.innerText = 'Prompt Anda akan muncul di sini...';
        }

        globalNotif.success("Semua pengaturan berhasil direset!");
        }

    
    
    
    // fungsi copy paste
    
      function copyFinalPrompt() {
      const promptText = document.getElementById("finalPromptDisplay").innerText;
      navigator.clipboard.writeText(promptText)
        .then(() => {
          globalNotif.success("Prompt berhasil disalin!");
        })
        .catch(err => {
          console.error("Gagal menyalin teks:", err);
          globalNotif.error("Gagal menyalin teks!");
        });
    }
    // fungsi paste
        function pasteFinalPrompt() {
            navigator.clipboard.readText()
            .then(text => {
            const textarea = document.getElementById("promptInput");
            if (!textarea) return;

            // Tempelkan teks ke posisi kursor, atau ganti seluruh isi jika tidak ada posisi kursor
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const before = textarea.value.substring(0, start);
            const after = textarea.value.substring(end);

            textarea.value = before + text + after;
            document.getElementById("finalPromptDisplay").innerText = textarea.value;

            // Atur kursor ke akhir teks yang dipaste
            const newPos = start + text.length;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();

            globalNotif.success("Prompt berhasil ditempel!");
            })
            .catch(err => {
            console.error("Gagal menempelkan teks:", err);
            globalNotif.error("Gagal menempelkan teks. Periksa izin clipboard.");
            });
        }

    
    // Theme switching
    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute('data-theme');
      
      if (currentTheme === 'dark') {
        body.removeAttribute('data-theme');
        localStorage.setItem('theme', 'yellow');
      } else {
        body.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
      }
    }
    
    // Set the theme from localStorage or default
    function setInitialTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
      } else {
        // Default theme is yellow (no data-theme attribute)
        document.body.removeAttribute('data-theme');
      }
    }
    
    // Initialize page elements
    document.addEventListener("DOMContentLoaded", () => {
      // Set initial theme
      setInitialTheme();
      
      // Add event listener to theme switch
      const themeSwitch = document.getElementById("themeSwitch");
      themeSwitch.addEventListener("click", toggleTheme);
      
      // Populate cyberpunk style select dropdown
      const cyberpunkStyleSelect = document.getElementById("cyberpunkStyleSelect");
      cyberpunkCreatorStyles.forEach(style => {
        const option = document.createElement("option");
        option.value = style;
        option.textContent = style;
        cyberpunkStyleSelect.appendChild(option);
      });
      
      // Populate art style select dropdown
      const artStyleSelect = document.getElementById("artStyleSelect");
      artStyles.forEach(style => {
        const option = document.createElement("option");
        option.value = style;
        option.textContent = style;
        artStyleSelect.appendChild(option);
      });
      
      // Populate camera effects select dropdown
      const cameraEffectSelect = document.getElementById("cameraEffectSelect");
      cameraFilters.forEach(filter => {
        const option = document.createElement("option");
        option.value = filter;
        option.textContent = filter;
        cameraEffectSelect.appendChild(option);
      });
      
      // Add event listener to prompt input to update the preview
      const promptInput = document.getElementById("promptInput");
      promptInput.addEventListener("input", updateFinalPromptPreview);
      
      // Initialize the prompt preview
      updateFinalPromptPreview();
      
      // Load image history
      loadImageHistory();
    });
    
    // Select cyberpunk creator style from dropdown
    function selectCyberpunkStyle(selectEl) {
      // Get selected style
      const style = selectEl.value;
      
      // If no style is selected (first option)
      if (!style) {
        selectedCyberpunkStyle = null;
      } else {
        selectedCyberpunkStyle = style;
        // Show notification that style was selected
        showNotification(`Gaya cyberpunk "${style}" dipilih`);
      }
      
      // Update the prompt preview
      updateFinalPromptPreview();
    }
    
    // Select art style from dropdown
    function selectArtStyle(selectEl) {
      // Get selected style
      const style = selectEl.value;
      
      // If no style is selected (first option)
      if (!style) {
        selectedStyle = null;
      } else {
        selectedStyle = style;
        // Show notification that style was selected
        showNotification(`Gaya "${style}" dipilih`);
      }
      
      // Update the prompt preview
      updateFinalPromptPreview();
    }
    
    // Select camera effect from dropdown
    function selectCameraEffect(selectEl) {
      // Get selected filter
      const filter = selectEl.value;
      
      // If no filter is selected (first option)
      if (!filter) {
        selectedFilter = null;
      } else {
        selectedFilter = filter;
        // Show notification that filter was selected
        showNotification(`Efek "${filter}" ditambahkan ke prompt Anda`);
      }
      
      // Update the prompt preview
      updateFinalPromptPreview();
    }
    // fungsi hapus
    function hapusText() {
        // Kosongkan textarea
        document.getElementById("promptInput").value = "";
    
        // Kosongkan preview prompt akhir
        document.getElementById("finalPromptDisplay").textContent = "Prompt Anda akan muncul di sini...";
      }
    
    // Select filter option
    function selectOption(element, type, value) {
      // Remove selection from all items of the same type
      const selector = ".filter-item";
      document.querySelectorAll(selector).forEach(item => {
        item.classList.remove("selected");
      });
      
      // If clicking on already selected item, deselect it
      if (element.classList.contains("selected")) {
        element.classList.remove("selected");
        selectedFilter = null;
      } else {
        // Add selection to clicked item
        element.classList.add("selected");
        
        // Save the selected value
        selectedFilter = value;
        // Show a brief notification that the effect was added
        showNotification(`Efek "${value}" ditambahkan ke prompt Anda`);
      }
      
      // Update the prompt preview to show the user what their final prompt will look like
      updateFinalPromptPreview();
    }
    
    // Function to update the final prompt preview
    function updateFinalPromptPreview() {
      const promptInput = document.getElementById("promptInput");
      const finalPromptDisplay = document.getElementById("finalPromptDisplay");
      
      const prompt = promptInput.value.trim();
      let fullPrompt = prompt;
      
      // Add cyberpunk style at the beginning if selected
      if (selectedCyberpunkStyle) {
        fullPrompt = `${selectedCyberpunkStyle}, ${fullPrompt}`;
      }
      
      if (selectedStyle) {
        fullPrompt += `, ${selectedStyle} style`;
      }
      
      if (selectedFilter) {
        fullPrompt += `, ${selectedFilter} filter`;
      }
      
      if (fullPrompt) {
        // Highlight the cyberpunk style part if it exists
        if (selectedCyberpunkStyle) {
          const parts = fullPrompt.split(`${selectedCyberpunkStyle}, `);
          fullPrompt = `<span class="camera-effect-highlight">${selectedCyberpunkStyle},</span> ${parts[1]}`;
        }
        
        // Highlight the camera effect part if it exists
        if (selectedFilter) {
          const filterText = `, ${selectedFilter} filter`;
          if (fullPrompt.includes(filterText)) {
            fullPrompt = fullPrompt.replace(filterText, 
              `<span class="camera-effect-highlight">${filterText}</span>`);
          }
        }
        
        // Highlight the art style part if it exists
        if (selectedStyle) {
          const styleText = `, ${selectedStyle} style`;
          if (fullPrompt.includes(styleText)) {
            fullPrompt = fullPrompt.replace(styleText, 
              `<span class="camera-effect-highlight">${styleText}</span>`);
          }
        }
        
        finalPromptDisplay.innerHTML = fullPrompt;
      } else {
        finalPromptDisplay.textContent = "Prompt Anda akan muncul di sini...";
      }
    }
    
    // Sistem notifikasi global
    const globalNotif = {
        container: null,
        notifCount: 0,
        maxNotifs: 5,
        
        // Inisialisasi sistem notifikasi
        init: function() {
            this.container = document.getElementById('globalNotifContainer');
            if (!this.container) {
                this.container = document.createElement('div');
                this.container.id = 'globalNotifContainer';
                document.body.appendChild(this.container);
            }
        },
        
        // Tampilkan notifikasi
        show: function(message, type = 'info', duration = 3000, isStatusMessage = false, statusElement = null) {
            // Inisialisasi container jika belum
            if (!this.container) this.init();
            
            // Batasi jumlah notifikasi yang ditampilkan
            if (this.container.children.length >= this.maxNotifs) {
                this.container.removeChild(this.container.firstChild);
            }
            
            // Buat elemen notifikasi
            const notifId = 'notif-' + (++this.notifCount);
            const notif = document.createElement('div');
            notif.id = notifId;
            notif.className = `global-notif ${type}`;
            
            // Isi konten notifikasi
            const content = document.createElement('div');
            content.className = 'global-notif-content';
            content.textContent = message;
            
            // Tombol tutup
            const closeBtn = document.createElement('button');
            closeBtn.className = 'global-notif-close';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = () => this.close(notifId);
            
            // Progress bar
            const progress = document.createElement('div');
            progress.className = 'global-notif-progress';
            progress.style.animationDuration = (duration / 1000) + 's';
            
            // Gabungkan elemen-elemen
            notif.appendChild(content);
            notif.appendChild(closeBtn);
            notif.appendChild(progress);
            
            // Tambahkan ke container
            this.container.appendChild(notif);
            
            // Animasi masuk
            setTimeout(() => notif.classList.add('show'), 10);
            
            // Update status message jika diperlukan
            if (isStatusMessage && statusElement) {
                statusElement.textContent = message;
                statusElement.hidden = false;
            }
            
            // Hapus notifikasi setelah durasi tertentu
            if (duration > 0) {
                setTimeout(() => {
                    if (document.getElementById(notifId)) {
                        this.close(notifId);
                    }
                }, duration);
            }
            
            return notifId;
        },
        
        // Tutup notifikasi
        close: function(notifId) {
            const notif = document.getElementById(notifId);
            if (notif) {
                notif.classList.remove('show');
                setTimeout(() => {
                    if (notif.parentNode) {
                        notif.parentNode.removeChild(notif);
                    }
                }, 300);
            }
        },
        
        // Tampilkan notifikasi sukses
        success: function(message, duration = 3000, isStatusMessage = false, statusElement = null) {
            return this.show(message, 'success', duration, isStatusMessage, statusElement);
        },
        
        // Tampilkan notifikasi error
        error: function(message, duration = 4000, isStatusMessage = false, statusElement = null) {
            return this.show(message, 'error', duration, isStatusMessage, statusElement);
        },
        
        // Tampilkan notifikasi info
        info: function(message, duration = 3000, isStatusMessage = false, statusElement = null) {
            return this.show(message, 'info', duration, isStatusMessage, statusElement);
        },
        
        // Tampilkan notifikasi warning
        warning: function(message, duration = 3500, isStatusMessage = false, statusElement = null) {
            return this.show(message, 'warning', duration, isStatusMessage, statusElement);
        }
    };
    
    // Fungsi showNotification yang lama, sekarang menggunakan sistem baru
    function showNotification(message) {
        globalNotif.info(message);
    }
    
    // Event emitter function to update generation status
    function updateStatus(statusData, containerIndex) {
      const statusMessage = document.querySelectorAll(".statusMessage")[containerIndex];
      
      if (statusData.data.description) {
        statusMessage.textContent = statusData.data.description;
        statusMessage.hidden = false;
        // Hapus notifikasi global di sini, hanya tampilkan teks di status message
        // globalNotif.info(statusData.data.description, 2000, true, statusMessage);
      }
      
      if (statusData.data.done) {
        setTimeout(() => {
          statusMessage.hidden = true;
        }, 3000);
      }
    }
    
    // Function to encode URI component properly
    function encodeURIComponentSafe(str) {
      return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
        return '%' + c.charCodeAt(0).toString(16);
      });
    }
    
   // Fungsi untuk mendapatkan IP pengguna (untuk identifikasi penyimpanan)
async function getUserIP() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    } catch (error) {
        console.error("Gagal mendapatkan IP:", error);
        return "unknown"; // Fallback jika gagal mendapatkan IP
    }
}

// Fungsi untuk menyimpan gambar ke history
async function saveImageToHistory(imageUrl, prompt) {
    try {
        // Dapatkan IP pengguna untuk identifikasi
        const userIP = await getUserIP();
        
        // Ambil history yang sudah ada
        let imageHistory = JSON.parse(localStorage.getItem(`imageHistory_${userIP}`)) || [];
        
        // Tambahkan gambar baru ke history
        const timestamp = new Date().getTime();
        imageHistory.push({
            url: imageUrl,
            prompt: prompt || "Tidak ada deskripsi",
            timestamp: timestamp
        });
        
        // Hapus gambar yang lebih dari 24 jam
        const oneDayAgo = timestamp - (24 * 60 * 60 * 1000);
        imageHistory = imageHistory.filter(item => item.timestamp >= oneDayAgo);
        
        // Simpan kembali ke localStorage
        localStorage.setItem(`imageHistory_${userIP}`, JSON.stringify(imageHistory));
        
        // Perbarui tampilan history
        loadImageHistory();
    } catch (error) {
        console.error("Gagal menyimpan gambar ke history:", error);
        globalNotif.error("Gagal menyimpan gambar ke history");
    }
}

// Fungsi untuk memuat dan menampilkan history gambar
async function loadImageHistory() {
    try {
        const userIP = await getUserIP();
        const imageHistory = JSON.parse(localStorage.getItem(`imageHistory_${userIP}`)) || [];
        const historyGrid = document.getElementById('historyGrid');
        
        // Kosongkan grid sebelum menambahkan item baru
        historyGrid.innerHTML = '';
        
        // Tampilkan pesan jika tidak ada history
        if (imageHistory.length === 0) {
            historyGrid.innerHTML = '<p class="no-history">Belum ada gambar dalam history</p>';
            return;
        }
        
        // Urutkan history dari yang terbaru
        imageHistory.sort((a, b) => b.timestamp - a.timestamp);
        
        // Tambahkan setiap gambar ke grid
        imageHistory.forEach((item, index) => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            // Buat thumbnail gambar
            const img = document.createElement('img');
            img.src = item.url;
            img.alt = item.prompt;
            img.title = item.prompt;
            img.onclick = () => previewHistoryImage(item.url, item.prompt);
            
            // Buat tombol hapus
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '√ó';
            deleteBtn.title = 'Hapus dari history';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteHistoryItem(index);
            };
            
            // Tambahkan elemen ke item history
            historyItem.appendChild(img);
            historyItem.appendChild(deleteBtn);
            
            // Tambahkan item ke grid
            historyGrid.appendChild(historyItem);
        });
    } catch (error) {
        console.error("Gagal memuat history gambar:", error);
        globalNotif.error("Gagal memuat history gambar");
    }
}

// Fungsi untuk menghapus item dari history
async function deleteHistoryItem(index) {
    try {
        const userIP = await getUserIP();
        let imageHistory = JSON.parse(localStorage.getItem(`imageHistory_${userIP}`)) || [];
        
        // Hapus item dengan index tertentu
        imageHistory.splice(index, 1);
        
        // Simpan kembali ke localStorage
        localStorage.setItem(`imageHistory_${userIP}`, JSON.stringify(imageHistory));
        
        // Perbarui tampilan
        loadImageHistory();
        globalNotif.success("Gambar berhasil dihapus dari history");
    } catch (error) {
        console.error("Gagal menghapus item history:", error);
        globalNotif.error("Gagal menghapus gambar dari history");
    }
}

// Fungsi untuk menghapus semua history
async function clearHistory() {
    try {
        const userIP = await getUserIP();
        localStorage.removeItem(`imageHistory_${userIP}`);
        loadImageHistory();
        globalNotif.success("History gambar berhasil dihapus");
    } catch (error) {
        console.error("Gagal menghapus history:", error);
        globalNotif.error("Gagal menghapus history gambar");
    }
}

// Fungsi untuk mengunduh semua gambar dari history
async function downloadHistory() {
    try {
        const userIP = await getUserIP();
        const imageHistory = JSON.parse(localStorage.getItem(`imageHistory_${userIP}`)) || [];
        
        if (imageHistory.length === 0) {
            globalNotif.warning("Tidak ada gambar dalam history untuk diunduh");
            return;
        }
        
        globalNotif.info("Mempersiapkan unduhan gambar...");
        
        // Unduh setiap gambar secara berurutan
        for (let i = 0; i < imageHistory.length; i++) {
            const item = imageHistory[i];
            
            // Buat elemen link untuk mengunduh
            const link = document.createElement('a');
            
            try {
                // Coba unduh sebagai blob
                const response = await fetch(item.url);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                
                link.href = url;
                link.download = `ai-image-${new Date(item.timestamp).toISOString().slice(0, 10)}-${i+1}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            } catch (fetchError) {
                console.error("Gagal mengunduh gambar:", fetchError);
                // Fallback: gunakan URL langsung
                link.href = item.url;
                link.download = `ai-image-${new Date(item.timestamp).toISOString().slice(0, 10)}-${i+1}.png`;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Delay antar unduhan
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        globalNotif.success("Semua gambar history berhasil diunduh!");
    } catch (error) {
        console.error("Gagal mengunduh history:", error);
        globalNotif.error("Gagal mengunduh beberapa gambar dari history");
    }
}

// Function to preview image from history with detailed info
function previewHistoryImage(imageUrl, prompt, style, size, seed) {
    let modal = document.getElementById('historyModal');
    
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'historyModal';
        modal.className = 'history-modal';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'history-modal-content';
        
        // Create close button
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = () => modal.style.display = 'none';
        
        // Create flex container for image and info
        const flexContainer = document.createElement('div');
        flexContainer.className = 'modal-flex-container';
        
        // Create info section (left side)
        const infoSection = document.createElement('div');
        infoSection.className = 'info-section';
        
        const infoContainer = document.createElement('div');
        infoContainer.className = 'image-info';
        
        // Create info elements
        // Create info elements for real image details
        const promptInfo = document.createElement('p');
        promptInfo.className = 'info-prompt';
        promptInfo.setAttribute('data-info-type', 'prompt');
        
        const styleInfo = document.createElement('p'); 
        styleInfo.className = 'info-style';
        styleInfo.setAttribute('data-info-type', 'style');
        
        const sizeInfo = document.createElement('p');
        sizeInfo.className = 'info-size';
        sizeInfo.setAttribute('data-info-type', 'dimensions');
        
        const seedInfo = document.createElement('p');
        seedInfo.className = 'info-seed';
        seedInfo.setAttribute('data-info-type', 'seed');
        
        // Create social share buttons
        const shareContainer = document.createElement('div');
        shareContainer.className = 'share-container';
        shareContainer.innerHTML = `
            <h3>Share on Social Media</h3>
            <div class="share-buttons">
                <button onclick="shareToFacebook('${imageUrl}')" class="share-btn facebook">
                    <i class="fab fa-facebook-f"></i>
                </button>
                <button onclick="shareToTwitter('${imageUrl}')" class="share-btn twitter">
                    <i class="fab fa-twitter"></i>
                </button>
                <button onclick="shareToInstagram('${imageUrl}')" class="share-btn instagram">
                    <i class="fab fa-instagram"></i>
                </button>
                <button onclick="shareToWhatsapp('${imageUrl}')" class="share-btn whatsapp">
                    <i class="fab fa-whatsapp"></i>
                </button>
            </div>
        `;
        
        // Add info elements to container
        infoContainer.appendChild(promptInfo);
        infoContainer.appendChild(styleInfo);
        infoContainer.appendChild(sizeInfo);
        infoContainer.appendChild(seedInfo);
        
        // Add info container and share buttons to info section
        infoSection.appendChild(infoContainer);
        infoSection.appendChild(shareContainer);
        
        // Create image section (right side)
        const imageSection = document.createElement('div');
        imageSection.className = 'image-section';
        const img = document.createElement('img');
        img.className = 'preview-image';
        imageSection.appendChild(img);
        
        // Assemble flex container
        flexContainer.appendChild(infoSection);
        flexContainer.appendChild(imageSection);
        
        // Assemble modal content
        modalContent.appendChild(closeBtn);
        modalContent.appendChild(flexContainer);
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Add styles
        const style = document.createElement('style');
        style.textContent = `
            .history-modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                justify-content: center;
                align-items: center;
            }
            
            .history-modal-content {
                background: var(--bg-color);
                padding: 20px;
                border-radius: var(--border-radius);
                max-width: 80%;
                max-height: 80vh;
                overflow: auto;
                position: relative;
                box-shadow: var(--box-shadow-convex);
            }
            
            .modal-flex-container {
                display: flex;
                gap: 20px;
                align-items: flex-start;
            }
            
            .info-section {
                flex: 1;
                min-width: 250px;
            }
            
            .image-section {
                flex: 2;
            }
            
            .preview-image {
                width: 100%;
                height: auto;
                border-radius: var(--border-radius);
                box-shadow: var(--box-shadow-convex);
            }
            
            .image-info {
                padding: 15px;
                background: var(--bg-secondary);
                border-radius: var(--border-radius);
                margin-bottom: 15px;
            }
            
            .image-info p {
                margin: 10px 0;
                color: var(--text-color);
                font-size: 12px;
                line-height: 1.4;
            }
            
            .close {
                position: absolute;
                right: 10px;
                top: 8px;
                font-size: 24px;
                cursor: pointer;
                color: var(--text-color);
                transition: color 0.3s ease;
            }
            
            .close:hover {
                color: var(--accent-color);
            }
            
            .share-container {
                padding: 15px;
                background: var(--bg-secondary);
                border-radius: var(--border-radius);
            }
            
            .share-container h3 {
                margin: 0 0 10px 0;
                color: var(--text-color);
                font-size: 14px;
            }
            
            .share-buttons {
                display: flex;
                gap: 8px;
            }
            
            .share-btn {
                width: 32px;
                height: 32px;
                border: none;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: transform 0.3s ease;
                color: white;
            }
            
            .share-btn:hover {
                transform: scale(1.1);
            }
            
            .facebook { background: #3b5998; }
            .twitter { background: #1da1f2; }
            .instagram { background: #e1306c; }
            .whatsapp { background: #25d366; }
            
            @media (max-width: 768px) {
                .modal-flex-container {
                    flex-direction: column-reverse;
                }
                
                .info-section,
                .image-section {
                    width: 100%;
                }
            }
        `;
        document.head.appendChild(style);
        
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }
    
    // Update modal content
    const img = modal.querySelector('.preview-image');
    const promptInfo = modal.querySelector('.info-prompt');
    const styleInfo = modal.querySelector('.info-style');
    const sizeInfo = modal.querySelector('.info-size');
    const seedInfo = modal.querySelector('.info-seed');
    
    img.src = imageUrl;
    img.alt = prompt;
    
    promptInfo.textContent = `Prompt: ${prompt}`;
    styleInfo.textContent = `Style: ${style || 'Default'}`;
    sizeInfo.textContent = `Size: ${size || 'Default'}`;
    seedInfo.textContent = `Seed: ${seed || 'Random'}`;
    
    modal.style.display = 'flex';
}

// Generate AI image using Pollinations API
async function generateAiImage() {
    if (isGenerating) return;
    
    const promptInput = document.getElementById("promptInput");
    const modelSelect = document.getElementById("modelSelect");
    const formatSelect = document.getElementById("formatSelect");
    const enhanceCheck = document.getElementById("enhanceCheck");
    const downloadAllBtn = document.getElementById("downloadAllBtn");
    const addContainerBtn = document.getElementById("addContainerBtn");
    const generateBtn = document.getElementById("generateBtn");
    const genCount = document.getElementById("genCount");
    
    const prompt = promptInput.value.trim();
    if (!prompt) {
        globalNotif.warning("Silakan masukkan deskripsi untuk gambar Anda");
        return;
    }
    
    // Store the original prompt for regeneration
    originalPrompt = prompt;
    
    // Update UI to loading state
    isGenerating = true;
    generateBtn.disabled = true;
    generateBtn.textContent = "Menghasilkan...";
    
    // Reset current image URLs
    currentImageUrls = [];
    
    // Hide download button while generating
    downloadAllBtn.hidden = true;
    
    // Hanya memproses container yang terlihat di DOM
    const containers = document.querySelectorAll('.image-container');
    const containerCount = containers.length;
    
    // Persiapkan semua container yang ada
    for (let i = 0; i < containerCount; i++) {
        const resultImageContainer = document.getElementById(`resultImageContainer${i}`);
        if (!resultImageContainer) continue; // Skip jika container tidak ada
        
        const initialMessage = resultImageContainer.querySelector(".initialMessage");
        const resultImage = resultImageContainer.querySelector(".resultImage");
        const statusMessage = resultImageContainer.querySelector(".statusMessage");
        const regenerateBtn = resultImageContainer.querySelector(".regenerate-style-btn");
        const downloadBtn = resultImageContainer.querySelector(".download-image-btn");
        
        // Hide regenerate and download buttons
        regenerateBtn.hidden = true;
        downloadBtn.hidden = true;
        
        // Create loading indicator
        const loadingIndicator = document.createElement("div");
        loadingIndicator.className = "loading-indicator";
        resultImageContainer.appendChild(loadingIndicator);
        initialMessage.hidden = true;
        resultImage.hidden = true;
        
        // Tampilkan status message dan notifikasi global
        const statusText = "Pembuatan gambar dimulai";
        statusMessage.textContent = statusText;
        statusMessage.hidden = false;
        globalNotif.info(statusText, 3000, true, statusMessage);
    }
    
    try {
        // Get selected options
        const model = modelSelect.value;
        const imageFormat = formatSelect.value;
        const enhance = enhanceCheck.checked;
        
        // Combine prompt with selected style and filter
        let fullPrompt = prompt;
        
        // Add cyberpunk style at the beginning if selected
        if (selectedCyberpunkStyle) {
            fullPrompt = `${selectedCyberpunkStyle}, ${fullPrompt}`;
        }
        
        if (selectedStyle) {
            fullPrompt += `, ${selectedStyle} style`;
        }
        if (selectedFilter) {
            fullPrompt += `, ${selectedFilter} filter`;
        }
        
        // Create image URLs using the Pollinations.ai Text-To-Image API
        const formats = {
            "default": [1080, 1920],
            "square": [1080, 1080],
            "landscape": [1920, 1080],
            "landscape_large": [2560, 1440],
            "portrait": [1080, 1920],
            "portrait_large": [1440, 2560]
        };
        
        const [width, height] = formats[imageFormat] || formats["default"];
        
        // Generate variations hanya untuk jumlah container yang ada
        const variations = [];
        for (let i = 0; i < containerCount; i++) {
            variations.push({ 
                seed: Math.floor(Math.random() * 1000000), 
                weightingText: `versi ${i+1}` 
            });
        }
        
        // Create URLs for all images
        const urls = variations.map(v => 
            `https://image.pollinations.ai/prompt/${encodeURIComponentSafe(fullPrompt)}?width=${width}&height=${height}&model=${model}&nologo=true&enhance=${enhance}&seed=${v.seed}`
        );
        
        // Store the URLs for download
        currentImageUrls = urls;
        
        // Simulate the event emitter calls for each image
        for (let i = 0; i < containerCount; i++) {
            await new Promise(resolve => {
                setTimeout(() => {
                    updateStatus({
                        data: {
                            description: `Menghasilkan gambar ${i+1}/${containerCount}...`,
                            status: "in_progress",
                            done: false
                        },
                        type: "status"
                    }, i);
                    resolve();
                }, 500);
            });
        }
        
        // Load all images from the Pollinations API
        const loadPromises = urls.map((url, index) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                
                img.onload = () => {
                    const resultImageContainer = document.getElementById(`resultImageContainer${index}`);
                    if (!resultImageContainer) {
                        resolve(); // Skip jika container tidak ada
                        return;
                    }
                    
                    const resultImage = resultImageContainer.querySelector(".resultImage");
                    const loadingIndicator = resultImageContainer.querySelector(".loading-indicator");
                    const regenerateBtn = resultImageContainer.querySelector(".regenerate-style-btn");
                    const downloadBtn = resultImageContainer.querySelector(".download-image-btn");
                    
                    resultImage.src = url;
                    resultImage.hidden = false;
                    
                    // Show the regenerate and download buttons
                    regenerateBtn.hidden = false;
                    downloadBtn.hidden = false;
                    
                    updateStatus({
                        data: {
                            description: `Gambar ${index+1} dihasilkan`,
                            status: "complete",
                            done: true
                        },
                        type: "status"
                    }, index);
                    
                    // Clean up
                    if (loadingIndicator) {
                        resultImageContainer.removeChild(loadingIndicator);
                    }
                    
                    resolve();
                };
                
                img.onerror = () => {
                    reject(new Error(`Gagal memuat gambar ${index+1}`));
                };
                
                img.src = url;
            });
        });
        
        // Wait for all images to load
        await Promise.all(loadPromises);
        
        // Simpan gambar ke history
        for (let i = 0; i < currentImageUrls.length; i++) {
            saveImageToHistory(currentImageUrls[i], originalPrompt);
        }
        
        // Update generation count only once for the batch
        generationCount++;
        genCount.textContent = generationCount;
        
        // Show download button and add container button
        downloadAllBtn.hidden = false;
        addContainerBtn.hidden = false;
        
        // Reset UI state
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate Gambar";
        isGenerating = false;
        
    } catch (error) {
        console.error("Error generating images:", error);
        
        // Show error on all containers that haven't loaded yet
        const containers = document.querySelectorAll('.image-container');
        for (let i = 0; i < containers.length; i++) {
            const resultImageContainer = document.getElementById(`resultImageContainer${i}`);
            if (!resultImageContainer) continue;
            
            const initialMessage = resultImageContainer.querySelector(".initialMessage");
            const loadingIndicator = resultImageContainer.querySelector(".loading-indicator");
            
            if (loadingIndicator) {
                updateStatus({
                    data: {
                        description: `Kesalahan: ${error.message}`,
                        status: "complete",
                        done: true
                    },
                    type: "status"
                }, i);
                
                initialMessage.hidden = false;
                resultImageContainer.removeChild(loadingIndicator);
            }
        }
        
        // Reset UI state
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate Gambar";
        isGenerating = false;
      }  // Ini adalah akhir dari blok catch
}
        
        // Show error on all containers that haven't loaded yet
        for (let i = 0; i < 4; i++) {
          const resultImageContainer = document.getElementById(`resultImageContainer${i}`);
          const initialMessage = resultImageContainer.querySelector(".initialMessage");
          const loadingIndicator = resultImageContainer.querySelector(".loading-indicator");
          
          if (loadingIndicator) {
            updateStatus({
              data: {
                description: `Kesalahan: ${error.message}`,
                status: "complete",
                done: true
              },
              type: "status"
            }, i);
            
            initialMessage.hidden = false;
            resultImageContainer.removeChild(loadingIndicator);
          }
        }
        
        globalNotif.error("Gagal menghasilkan beberapa gambar. Silakan coba lagi.");
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate Gambar";
        isGenerating = false;
        
    // Function to download an individual image
    async function downloadImage(index) {
      if (!currentImageUrls[index]) {
        globalNotif.error("Tidak ada gambar untuk diunduh.");
        return;
      }
      
      try {
        // Get the image element that's already displayed
        const imageContainer = document.getElementById(`resultImageContainer${index}`);
        const imgElement = imageContainer.querySelector('.resultImage');
        
        
        // Show status message
        if (statusMessage) {
          const statusText = "Mempersiapkan unduhan...";
          statusMessage.textContent = statusText;
          statusMessage.hidden = false;
          globalNotif.info(statusText, 2000, true, statusMessage);
        }
        
        // Ensure the image is fully loaded before proceeding
        if (imgElement && !imgElement.complete) {
          await new Promise((resolve, reject) => {
            imgElement.onload = resolve;
            imgElement.onerror = reject;
            // Set a timeout in case it never loads
            setTimeout(resolve, 3000);
          });
        }
        
        try {
          // Method 1: Try using fetch API first
          const response = await fetch(currentImageUrls[index]);
          const blob = await response.blob();
          
          // Create download link
          const downloadLink = document.createElement('a');
          downloadLink.href = URL.createObjectURL(blob);
          downloadLink.download = `tkk-creator-ai-image-${index+1}.jpeg`;
          downloadLink.style.display = 'none';
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);
          
          if (statusMessage) {
            const successText = "Gambar berhasil diunduh!";
            statusMessage.textContent = successText;
            setTimeout(() => {
              statusMessage.hidden = true;
            }, 2000);
            globalNotif.success(successText, 2000, true, statusMessage);
          }
          
        } catch (error) {
          // Method 2: Fall back to using the image element's src if fetch fails
          const downloadLink = document.createElement('a');
          downloadLink.href = imgElement.src;
          downloadLink.download = `tkk-creator-ai-image-${index+1}.jpeg`;
          downloadLink.style.display = 'none';
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);
          
          if (statusMessage) {
            const successText = "Gambar berhasil diunduh!";
            statusMessage.textContent = successText;
            setTimeout(() => {
              statusMessage.hidden = true;
            }, 2000);
            globalNotif.success(successText, 2000, true, statusMessage);
          }
        }
        
      } catch (error) {
        console.error("Error downloading image:", error);
        globalNotif.error("Gagal mengunduh gambar. Coba lagi nanti.", 4000);
        
        const imageContainer = document.getElementById(`resultImageContainer${index}`);
        const statusMessage = imageContainer.querySelector(".statusMessage");
        if (statusMessage) {
          const errorText = "Gagal mengunduh gambar";
          statusMessage.textContent = errorText;
          setTimeout(() => {
            statusMessage.hidden = true;
          }, 3000);
          globalNotif.error(errorText, 3000, true, statusMessage);
        }
      }
    }
    
    // Function to download all images
    async function downloadAllImages() {
      if (!currentImageUrls.length) {
        globalNotif.warning("Tidak ada gambar untuk diunduh.");
        return;
      }
      
      try {
        for (let i = 0; i < currentImageUrls.length; i++) {
          await downloadImage(i);
          
          // Small delay between downloads to prevent browser throttling
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        showNotification("Semua gambar berhasil diunduh!");
        
      } catch (error) {
        console.error("Error downloading all images:", error);
        globalNotif.error("Gagal mengunduh beberapa gambar. Coba lagi nanti.");
      }
    }
    
    // Function to regenerate an image with the selected style
    async function regenerateWithStyle(index) {
      if (isGenerating) return;
      
      // Check if there's a selected style
      if (!selectedStyle && !selectedFilter && !selectedCyberpunkStyle) {
        globalNotif.warning("Pilih gaya seni atau efek kamera terlebih dahulu.");
        return;
      }
      
      // Update UI to loading state
      isGenerating = true;
      
      const resultImageContainer = document.getElementById(`resultImageContainer${index}`);
      const resultImage = resultImageContainer.querySelector(".resultImage");
      const statusMessage = resultImageContainer.querySelector(".statusMessage");
      const regenerateBtn = resultImageContainer.querySelector(".regenerate-style-btn");
      const downloadBtn = resultImageContainer.querySelector(".download-image-btn");
      
      // Hide buttons and image
      regenerateBtn.hidden = true;
      downloadBtn.hidden = true;
      resultImage.hidden = true;
      
      // Create loading indicator
      const loadingIndicator = document.createElement("div");
      loadingIndicator.className = "loading-indicator";
      resultImageContainer.appendChild(loadingIndicator);
      
      // Show status message
      statusMessage.textContent = "Menghasilkan ulang dengan gaya terpilih...";
      statusMessage.hidden = false;
      
      try {
        // Get selected options from main UI
        const modelSelect = document.getElementById("modelSelect");
        const formatSelect = document.getElementById("formatSelect");
        const enhanceCheck = document.getElementById("enhanceCheck");
        
        const model = modelSelect.value;
        const imageFormat = formatSelect.value;
        const enhance = enhanceCheck.checked;
        
        // Use original prompt if available, otherwise use whatever is in the input
        const promptInput = document.getElementById("promptInput");
        let prompt = originalPrompt || promptInput.value.trim();
        
        // Combine prompt with selected style and filter
        let fullPrompt = prompt;
        
        // Add cyberpunk style at the beginning if selected
        if (selectedCyberpunkStyle) {
          fullPrompt = `${selectedCyberpunkStyle}, ${fullPrompt}`;
        }
        
        if (selectedStyle) {
          fullPrompt += `, ${selectedStyle} style`;
        }
        if (selectedFilter) {
          fullPrompt += `, ${selectedFilter} filter`;
        }
        
        // Create image URL using the Pollinations.ai Text-To-Image API
        const formats = {
          "default": [1080, 1920],
          "square": [1080, 1080],
          "landscape": [1920, 1080],
          "landscape_large": [2560, 1440],
          "portrait": [1080, 1920],
          "portrait_large": [1440, 2560]
        };
        
        const [width, height] = formats[imageFormat] || formats["default"];
        
        // Generate a new random seed
        const seed = Math.floor(Math.random() * 1000000);
        
        // Create URL for the image
        const url = `https://image.pollinations.ai/prompt/${encodeURIComponentSafe(fullPrompt)}?width=${width}&height=${height}&model=${model}&nologo=true&enhance=${enhance}&seed=${seed}`;
        
        // Store the URL for download
        currentImageUrls[index] = url;
        
        // Load the image
        await new Promise((resolve, reject) => {
          const img = new Image();
          
          img.onload = () => {
            resultImage.src = url;
            resultImage.hidden = false;
            
            // Show the buttons
            regenerateBtn.hidden = false;
            downloadBtn.hidden = false;
            
            globalNotif.success("Gambar berhasil dihasilkan ulang!", 3000, true, statusMessage);
            
            // Clean up
            if (loadingIndicator) {
              resultImageContainer.removeChild(loadingIndicator);
            }
            
            resolve();
          };
          
          img.onerror = () => {
            reject(new Error(`Gagal menghasilkan ulang gambar ${index+1}`));
          };
          
          img.src = url;
        });
        
        // Reset UI state
        isGenerating = false;
        
      } catch (error) {
        console.error("Error regenerating image:", error);
        
        // Show error
        globalNotif.error(`Kesalahan: ${error.message}`, 4000, true, statusMessage);
        
        // Clean up
        if (loadingIndicator) {
          resultImageContainer.removeChild(loadingIndicator);
        }
        
        resultImage.hidden = false;
        regenerateBtn.hidden = false;
        downloadBtn.hidden = false;
        
        isGenerating = false;
      }
    }
    
    // Fungsi untuk menambah container gambar baru
    function addImageContainer() {
        const imageGrid = document.getElementById("imageGrid");
        const containers = document.querySelectorAll('.image-container');
        const newIndex = containers.length;
        
        // Batasi maksimal 4 container
        if (newIndex >= 4) {
            showNotification("Maksimal 4 container gambar!");
            return;
        }
        
        // Buat container baru
        const newContainer = document.createElement("div");
        newContainer.className = "image-container";
        newContainer.id = `resultImageContainer${newIndex}`;
        
        // Isi container dengan elemen yang sama seperti container pertama
        newContainer.innerHTML = `
            <p class="initialMessage">Gambar yang dihasilkan AI akan muncul di sini</p>
            <img class="resultImage" hidden onclick="previewImage(this)">
            <span class="close" onclick="closeModal()" hidden>√ó</span>
            <div class="statusMessage" hidden></div>
            <button class="regenerate-style-btn" onclick="regenerateWithStyle(${newIndex})" hidden>Generate ulang</button>
            <button class="download-image-btn" onclick="downloadImage(${newIndex})" hidden>Unduh Gambar</button>
        `;
        
        // Tambahkan ke grid
        imageGrid.appendChild(newContainer);
        
        // Tampilkan notifikasi
        showNotification(`Container gambar #${newIndex+1} ditambahkan!`);
        
        // Jika sudah mencapai batas maksimal, sembunyikan tombol tambah
        if (newIndex + 1 >= 4) {
            document.getElementById("addContainerBtn").hidden = true;
        }
    }
    
    // Fungsi untuk menghapus container terakhir yang ditambahkan
    function resetLastContainer() {
        const imageGrid = document.getElementById("imageGrid");
        const containers = document.querySelectorAll('.image-container');
        const containerCount = containers.length;
        
        // Jika hanya ada satu container (container default), tampilkan notifikasi
        if (containerCount <= 1) {
            globalNotif.warning("Tidak ada container tambahan yang dapat dihapus!");
            return;
        }
        
        // Ambil container terakhir
        const lastContainer = containers[containerCount - 1];
        const containerIndex = containerCount - 1;
        
        // Hapus container dari grid
        imageGrid.removeChild(lastContainer);
        
        // Tampilkan notifikasi
        globalNotif.success(`Container gambar #${containerIndex+1} telah dihapus!`);
        
        // Update tombol download all jika perlu
        updateDownloadAllButton();
        
        // Pastikan tombol tambah container selalu terlihat setelah menghapus
        document.getElementById("addContainerBtn").hidden = false;
    }
    
    // Fungsi untuk update tombol download all (jika ada)
    function updateDownloadAllButton() {
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        if (downloadAllBtn) {
            const images = document.querySelectorAll('.resultImage:not([hidden])');
            downloadAllBtn.hidden = images.length === 0;
        }
    }
    
    //fungsi gennerate histori
    function generateImages() {
      saveAllResultImagesToHistory(); // simpan semua sebelum generate ulang
    
      for (let i = 0; i < 4; i++) {
        const img = document.querySelector(`#resultImageContainer${i} .resultImage`);
        const msg = document.querySelector(`#resultImageContainer${i} .initialMessage`);
        const newUrl = `https://picsum.photos/300?random=${Math.random()}`;
    
        img.src = newUrl;
        img.hidden = false;
        if (msg) msg.style.display = 'none';
      }
    }
    
    
    </script>
      
    <!-- Modal Preview -->
    <div id="imagePreviewModal" class="modal" onclick="closePreview()" style="display:none;">
      <span class="close-button" onclick="closePreview(event)">&times;</span>
      <img class="modal-content" id="previewedImage">
    </div>
    
      <script>
      function closeModal() {
        // Misal kamu punya modal dengan class "modal"
        const modal = document.querySelector('.modal');
        if (modal) {
          modal.style.display = 'none';
        }
      }
      </script>
    
    <script>
    function saveAllResultImagesToHistory() {
      const historyGrid = document.getElementById('historyGrid');
    
      for (let i = 0; i < 4; i++) {
        const img = document.querySelector(`#resultImageContainer${i} .resultImage`);
        if (img && !img.hidden && img.src) {
          const cloneImg = document.createElement('img');
          cloneImg.src = img.src;
          cloneImg.alt = `Generated Image ${i}`;
          cloneImg.onclick = () => previewImage(cloneImg); // Optional preview
          historyGrid.appendChild(cloneImg);
        }
      }
    }
    </script>
    
      
      <script>
        window.onload = function () {
        window.previewImage = function(imgElement) {
        // Cek apakah modal sudah ada
        let modal = document.getElementById('imageModal');
        let modalImg = document.getElementById('modalImage');
    
        // Jika belum ada, buat modal secara dinamis
        if (!modal) {
          modal = document.createElement('div');
          modal.id = 'imageModal';
          modal.className = 'modal';
          modal.innerHTML = `
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="modalImage">
          `;
          document.body.appendChild(modal);
          modalImg = document.getElementById('modalImage');
        }
    
        modal.style.display = 'block';
        modalImg.src = imgElement.src;
        };
    
        window.closeModal = function () {
        const modal = document.getElementById('imageModal');
        if (modal) {
          modal.style.display = 'none';
            }
        };
    
      // Klik di luar gambar juga menutup modal
      window.onclick = function(event) {
        const modal = document.getElementById('imageModal');
        if (event.target === modal) {
          modal.style.display = 'none';
            }
         };
        };
      </script>

    <style>

    /* footer*/

    .custom-footer {
      margin-top: 60px;
      padding: 20px;
      text-align: center;
      font-size: 14px;
      border-top: 1px solid var(--border-color, #ccc);
      color: var(--text-color-dark);
      background-color: var(--bg-color);
      transition: all 0.3s ease;
      -webkit-text-fill-color: var(--text-color);
    }

    .custom-footer strong {
      font-weight: 700;
      color: var(--text-color-dark, #13b913);
    }

    @media (prefers-color-scheme: dark) {
      .custom-footer {
        background-color: var(--bg-color);
        color: #eee;
        border-color: var(--bg-color);
      }

      .custom-footer strong {
        color: #13b913;
      }
    }

   



    </style>
  
    </body>
    
